# Quick Deploy プロジェクト要件定義書

## **1\. 概要**

### **1.1. プロジェクト名**

**Quick Deploy**

### **1.2. プロジェクトの目的**

スマートフォンやタブレット（以下、クライアントデバイス）からリモートサーバー（GitHub, SSH環境など）上のコーディングエージェントに指示を出し、Androidアプリ開発を行うケースを想定する。

このリモート環境でビルドされたAPK（Android Application Package）を、レビューや動作確認のために、**即時かつ簡潔な手順で**クライアントデバイスにインストールする仕組みを提供する。

### **1.3. 解決したい課題**

従来のGitHub ActionsのArtifactダウンロードやDeployGateなどのサードパーティ製配布サービスは、以下の課題を持つ。

* **手順の複雑さ:** ZIPファイルのダウンロード、解凍、インストール、各種サービスへのログインなど、テスト実行までのステップが多い。  
* **リアルタイム性の欠如:** ビルド完了からインストールまでに時間がかかり、カジュアルな開発サイクル（コーディング→ビルド→実機確認）を妨げる。

本プロジェクトは、これらの手順を大幅に簡略化し、**個人開発者**がコーディングエージェントの出力を**リアルタイム**に実機確認できるソリューションを目指す。

## **2\. 対象ユーザー**

* 個人でAndroidアプリを開発している開発者  
* クライアントデバイス（スマホ・タブレット）を開発インターフェースとして利用し、リモートサーバーでビルドを実行する開発者

## **3\. システム構成**

本システムは、以下の2つのコンポーネントで構成される。（Webサイトは初期スコープ外とする）

1. **Android アプリ (クライアント)**  
   * 動作確認を行うクライアントデバイス（スマホ・タブレット）にインストールされる。  
   * APKの受信とインストール、利用ガイドの表示を担当する。  
2. **Web API (サーバー)**  
   * ビルド環境とクライアントアプリを仲介するバックエンドサービス。  
   * APKファイルの一時的な受け渡しと、クライアントへの通知を行う。

**処理フローの想定:**

1. (準備) ユーザーはクライアントデバイスのAndroidアプリで、本サービス用の\*\*「APKアップロードURL」\*\*を取得する。  
2. (ビルド環境) 開発者はリモートサーバーのビルドスクリプト（GitHub Actionsなど）に、上記URLへのcurlコマンドなどを設定する。  
3. (ビルド環境) ビルドが完了すると、スクリプトがWeb APIにAPKファイルをPOSTする。  
4. (Web API) APKを受信し、一時ストレージに保存。  
5. (Web API) 紐づくAndroidアプリに対し、プッシュ通知（FCMなど）で「新規APK到着」を通知する。  
6. (Androidアプリ) 通知を受け取り、Web APIからAPKファイルをダウンロードする。  
7. (Androidアプリ) ダウンロード完了後、ユーザーにインストールを促すプロンプトを即時表示する。（C-004, C-005）

## **4\. 機能要件**

### **4.1. Android アプリ (クライアント)**

| ID | 機能名 | 機能概要 |
| :---- | :---- | :---- |
| **C-001** | **デバイス登録・URL発行** | アプリの初回起動時、Web APIと通信し、このデバイス専用の「APKアップロードURL」を生成・取得し、画面に表示する。あわせて、「URLをコピー」ボタンと「curlコマンドサンプルをコピー」ボタンを設置する。 |
| **C-002** | **APK到着通知の受信** | Web APIからのプッシュ通知（**Firebase Cloud Messaging**）を受け取ることができる。 |
| **C-003** | **APKダウンロード** | 通知受信時、または手動更新時に、Web APIから最新のAPKファイルをダウンロードする。 |
| **C-004** | **インストール実行** | APKのダウンロード完了後、インストールを実行する。実行時、C-005の権限チェックを事前に行う。 |
| **C-005** | **インストール権限ガイダンス** | インストール実行時（C-004）、『提供元不明のアプリ』のインストール権限（canRequestPackageInstalls）をチェックする。権限がない場合、ユーザーをOSの設定画面へ誘導し、許可を促すメッセージを表示する。 |
| **C-006** | **利用ガイド表示** | 本アプリの使い方（URLの発行方法、curlでの送信方法など）を説明するシンプルなガイド画面をアプリ内に表示する。 |

### **4.2. Web API (サーバー)**

| ID | 機能名 | 機能概要 |
| :---- | :---- | :---- |
| **A-001** | **デバイス登録** | Androidアプリからのリクエストに基づき、一意かつ推測困難な長いトークン（URLの一部）を発行し、FCMトークン等のデバイス情報と紐づけて Firestore に保存する。 備考：新しいURLが発行された場合、そのデバイスに紐づく古いURLは無効化される。  |
| **A-002** | **APKアップロード エンドポイント** | /upload/{device\_token} のようなREST APIエンドポイントを提供する。 multipart/form-data 形式でPOSTされたAPKファイルを受け付ける。 |
| **A-003** | **APK一時保存** | アップロードされたAPKファイルを Firebase Storage に保存する。 備考：新しいAPKがアップロードされた場合、そのデバイス用の古いAPKは即時削除（または上書き）される。最新のAPKも10分経過後に自動的に削除される。  |
| **A-004** | **クライアントへの通知** | A-002 へのアップロードが成功したら、{device\_token} に紐づくAndroidデバイスに対し、プッシュ通知（ Firebase Cloud Messaging ）を送信する。 通知メッセージ: 「新しいAPKを受信しました。タップしてインストールします。」  |
| **A-005** | **APKダウンロード エンドポイント** | AndroidアプリがAPKファイルをダウンロードするためのエンドポイント。 GET /download/{device\_token} の形式を想定。アップロード時の{device\_token}をそのまま利用する。 |

### **4.3. Web サイト**

* 初期開発スコープ外（セクション6を参照）。

## **5\. 非機能要件**

| 項目 | 要件 |
| :---- | :---- |
| **リアルタイム性** | ビルド環境がAPKのアップロードを完了してから、クライアントデバイスでインストールプロンプトが表示されるまでの時間は、**10秒以内**を目標とする。 |
| **簡潔性（ユーザー体験）** | **ビルド環境側:** curlコマンド1行（またはそれに準ずる簡単な設定）でAPKを送信できること。 **クライアント側:** 一度アプリをセットアップすれば、以降は「通知をタップ→インストールを許可」の2操作のみで完了すること。 |
| **セキュリティ** | 通信はすべてHTTPSで暗号化する。 APKアップロードURL（{device\_token}）は、推測困難な十分に長いトークン（Google Driveの共有URLのような形式）とすること。 本サービスは個人利用を前提とし、複雑なユーザー認証や組織管理機能は実装しない。 |
| **プラットフォーム** | **Androidアプリ:** Android 10.0 (API 29\) 以上を対象とする。 **Web API:** Firebase Functions (TypeScript) |
| **信頼性** | APKのアップロード・ダウンロードが失敗しないこと。プッシュ通知が確実に（OSの制約範囲内で）届くこと。 |

## **6\. スコープ外（やらないこと）**

* **iOS (ipaファイル) の配布:** 本プロジェクトはAndroid (APK) のみに焦点を当てる。  
* **複数人・組織での利用:** チームでの配布管理、テスターの招待機能などは対象外とする。  
* **ビルドの実行:** ビルド自体はユーザーの環境（GitHub Actions, SSHサーバー等）で行う前提であり、本システムはビルド機能を持たない。  
* **Google Playへの申請:** Google Playストアへの申請・公開プロセスは一切関与しない。あくまで開発中の動作確認（野良アプリのインストール）を支援する。  
* **Webサイトの構築:** ランディングページ（W-001）やお問合せフォーム（W-003）の作成は、初期リリースではスコープ外とする。（利用ガイドは C-006 としてアプリ内に実装）
