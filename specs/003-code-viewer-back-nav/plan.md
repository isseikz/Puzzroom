# Implementation Plan: Navigation from Code Viewer to File Explorer

**Branch**: `003-code-viewer-back-nav` | **Date**: 2026-02-21 | **Spec**: [/specs/003-code-viewer-back-nav/spec.md](/specs/003-code-viewer-back-nav/spec.md)
**Input**: Feature specification from `/specs/003-code-viewer-back-nav/spec.md`

## Summary
Add a "Back" button to the `CodeViewerSheet` header, positioned at the start (left) of the top row. The "Back" button will return the user to the File Explorer, while the "Close" button will exit the entire file browsing session. This change ensures bi-directional navigation between the file explorer and code viewer in `mobile-vibe-terminal`.

## Technical Context
**Language/Version**: Kotlin Multiplatform (KMP) 
**Primary Dependencies**: Compose Multiplatform, Material 3, `voyager` (navigator in TerminalScreen)
**Storage**: Transient UI state in `TerminalScreen` (using `mutableStateOf`)
**Testing**: Compose Desktop/Android tests (unit and UI)
**Target Platform**: Android, iOS, Web, Desktop
**Project Type**: Mobile Multi-App Monorepo (specifically `:mobile-vibe-terminal`)
**Performance Goals**: Transition between sheets under 300ms
**Constraints**: No state loss (scroll position, path) in File Explorer when returning from Code Viewer
**Scale/Scope**: UI/UX enhancement in `CodeViewerSheet` and `TerminalScreen`

## Constitution Check
*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **Principle I (Atomic Design)**: `CodeViewerSheet` acts as an Organism/Page-level component. Buttons are Atoms. Header will follow Molecule patterns.
- **Principle IV (Unidirectional Data Flow)**: `TerminalScreen` (Parent) will provide `onBack` and `onClose` callbacks to `CodeViewerSheet`.
- **Principle III (Theme Consistency)**: Styling must use `MaterialTheme` color schemes, respecting the `mobile-vibe-terminal` high-contrast terminal theme (green on black).
- **Principle VI (Worktree Isolation)**: Currently operating in `main` or existing worktree, but all work is tracked under feature branch `003-code-viewer-back-nav`.

## Project Structure

### Documentation (this feature)
```text
specs/003-code-viewer-back-nav/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output (N/A for UI-only change)
├── quickstart.md        # Phase 1 output
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)
```text
mobile-vibe-terminal/src/commonMain/kotlin/tokyo/isseikuzumaki/vibeterminal/
├── ui/
│   ├── components/
│   │   ├── CodeViewerSheet.kt  # Target for adding Back button and header update
│   │   └── FileExplorerSheet.kt
│   └── screens/
│       └── TerminalScreen.kt   # Update state management for Back vs Close actions
```

**Structure Decision**: Single module update within `:mobile-vibe-terminal`.

## Complexity Tracking
*No violations detected.*
